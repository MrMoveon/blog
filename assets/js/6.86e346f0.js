(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{202:function(a,s,t){a.exports=t.p+"assets/img/1.b8f857ab.jpg"},203:function(a,s,t){a.exports=t.p+"assets/img/2.077a29f1.jpg"},204:function(a,s,t){a.exports=t.p+"assets/img/3.79cb14e0.jpg"},205:function(a,s,t){a.exports=t.p+"assets/img/4.2815a67a.jpg"},206:function(a,s,t){a.exports=t.p+"assets/img/5.1834c504.jpg"},207:function(a,s,t){a.exports=t.p+"assets/img/6.a3a67351.jpg"},208:function(a,s,t){a.exports=t.p+"assets/img/7.a8304e73.jpg"},252:function(a,s,t){"use strict";t.r(s);var n=t(0),e=Object(n.a)({},function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"mongodb"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mongodb","aria-hidden":"true"}},[a._v("#")]),a._v(" mongoDB")]),a._v(" "),n("h2",{attrs:{id:"mongodb-安装和常用配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-安装和常用配置","aria-hidden":"true"}},[a._v("#")]),a._v(" mongoDB 安装和常用配置")]),a._v(" "),n("h3",{attrs:{id:"_1-mongodb-4-x-安装和配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-mongodb-4-x-安装和配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 1-mongoDB 4.X 安装和配置")]),a._v(" "),n("p",[a._v("1.社区版"),n("a",{attrs:{href:"https://www.mongodb.com/try/download/community",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),n("OutboundLink")],1)]),a._v(" "),n("p",[n("img",{attrs:{src:t(202),alt:"安装"}})]),a._v(" "),n("p",[a._v("2.配置环境变量")]),a._v(" "),n("ul",[n("li",[a._v("安装目录下的 bin 目录 ;")]),a._v(" "),n("li",[a._v("如:C:\\z_MongoDB\\bin；")]),a._v(" "),n("li",[a._v("配置到系统环境变量中（控制面板\\系统和安全\\系统\\高级系统设置\\环境变量；")]),a._v(" "),n("li",[a._v("会自动添加到服务中了；")]),a._v(" "),n("li",[a._v("重启运行命令 services.msc（window10）打开服务界面，此时已经自动添加到系统服务里面了，每次开机自动重启")])]),a._v(" "),n("p",[n("img",{attrs:{src:t(203),alt:"path环境变量"}}),a._v(" "),n("img",{attrs:{src:t(204),alt:"服务"}}),a._v(" "),n("img",{attrs:{src:t(205),alt:"运行结果"}})]),a._v(" "),n("h3",{attrs:{id:"_2-mongodb-账户权限配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-mongodb-账户权限配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 2-MongoDB 账户权限配置")]),a._v(" "),n("h4",{attrs:{id:"_1-创建超级管理员"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建超级管理员","aria-hidden":"true"}},[a._v("#")]),a._v(" 1.创建超级管理员")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("use admin\ndb.createUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    user:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'admin'")]),a._v("，\n    pwd:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'123456'")]),a._v(",\n    roles:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("role:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'root'")]),a._v(",db:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'admin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h4",{attrs:{id:"_2-修改-mongodb-数据库配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改-mongodb-数据库配置文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.修改 Mongodb 数据库配置文件")]),a._v(" "),n("p",[a._v("找到这个"),n("code",[a._v("mongod.cfg")]),a._v("配置文件 放开 security 表示开启权限验证")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 路径 C:\\Program Files\\MongoDB\\Server\\4.4\\bin\\mongod.cfg")]),a._v("\nsecurity:\n  authorization: enabled\n")])])]),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),n("p",[a._v("这个文件有严格的格式，authorization 冒号后面有一个空格，去掉或多加一个空格都会报错")])]),a._v(" "),n("h4",{attrs:{id:"_3-重启-mongodb"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-重启-mongodb","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.重启 mongodb")]),a._v(" "),n("p",[n("img",{attrs:{src:t(206),alt:"重启"}})]),a._v(" "),n("h4",{attrs:{id:"_4-超级管理员帐号链接数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-超级管理员帐号链接数据库","aria-hidden":"true"}},[a._v("#")]),a._v(" 4.超级管理员帐号链接数据库")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("mongo admin -u 帐号 -p 密码\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# or")]),a._v("\nmongo "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.200:27017/test -u user -p password\n")])])]),n("h4",{attrs:{id:"_5-给-eggcms-数据库创建一个用户，只能访问-eggcms-不能访问其他数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-给-eggcms-数据库创建一个用户，只能访问-eggcms-不能访问其他数据库","aria-hidden":"true"}},[a._v("#")]),a._v(" 5.给 eggcms 数据库创建一个用户，只能访问 eggcms 不能访问其他数据库")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("use eggcms\ndb.createUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        user: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggadmin"')]),a._v(",\n        pwd: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"123456"')]),a._v(",\n        roles: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" role: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dbOwner"')]),a._v(", db: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggcms"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"_3-mongodb-账户权限配置中常用的命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-mongodb-账户权限配置中常用的命令","aria-hidden":"true"}},[a._v("#")]),a._v(" 3-Mongodb 账户权限配置中常用的命令")]),a._v(" "),n("p",[n("strong",[a._v("db.createUser 创建用户")])]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("use eggcms\ndb.createUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        user: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggadmin"')]),a._v(",\n        pwd: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"123456"')]),a._v(",\n        roles: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" role: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dbOwner"')]),a._v(", db: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggcms"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# result")]),a._v("\nSuccessfully added user: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"user"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggadmin"')]),a._v(",\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"roles"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"role"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dbOwner"')]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"db"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggcms"')]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),n("p",[n("strong",[a._v("show users 查看当前库下的用户")])]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"_id"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin.admin"')]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"userId"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" UUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"6500ad3e-755c-4d3c-a23b-c0773c112dd8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"user"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"db"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"roles"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"role"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),a._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"db"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),a._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mechanisms"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"SCRAM-SHA-1"')]),a._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"SCRAM-SHA-256"')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("p",[n("strong",[a._v('db.dropUser("eggadmin") 删除用户')])]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入数据库eggcms")]),a._v("\nuse eggcms\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除用户eggadmin")]),a._v("\ndb.dropUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"eggadmin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),n("p",[n("strong",[a._v('db.updateUser("eggadmin",{pwd:"password"}) 修改用户')])]),a._v(" "),n("p",[n("strong",[a._v('db.auth("admin","password"); 密码认证')])]),a._v(" "),n("h3",{attrs:{id:"_4-mongodb-数据库角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-mongodb-数据库角色","aria-hidden":"true"}},[a._v("#")]),a._v(" 4-Mongodb 数据库角色")]),a._v(" "),n("ol",[n("li",[n("p",[a._v("数据库用户角色：read、readWrite;")])]),a._v(" "),n("li",[n("p",[a._v("数据库管理角色：dbAdmin、dbOwner、userAdmin；")])]),a._v(" "),n("li",[n("p",[a._v("集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；")])]),a._v(" "),n("li",[n("p",[a._v("备份恢复角色：backup、restore；")])]),a._v(" "),n("li",[n("p",[a._v("所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase")])]),a._v(" "),n("li",[n("p",[a._v("超级用户角色：root")])]),a._v(" "),n("li",[n("p",[a._v("参考：https://www.cnblogs.com/zzw1787044/p/5773178.html")])])]),a._v(" "),n("h3",{attrs:{id:"_5-连接数据库的时候需要配置账户密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-连接数据库的时候需要配置账户密码","aria-hidden":"true"}},[a._v("#")]),a._v(" 5-连接数据库的时候需要配置账户密码")]),a._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" url "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'mongodb://admin:123456@localhost:27017/'")]),a._v("\n")])])]),n("h3",{attrs:{id:"_6-导出与恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-导出与恢复","aria-hidden":"true"}},[a._v("#")]),a._v(" 6- 导出与恢复")]),a._v(" "),n("ol",[n("li",[a._v("MongoDB 4.4版本 之后 MongoDB数据库工具现在与MongoDB服务 分开发布 需要单独安装 "),n("a",{attrs:{href:"https://docs.mongodb.com/database-tools/",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),n("OutboundLink")],1)]),a._v(" "),n("li",[a._v("windwos 下载后解压，配置到环境变量 path 中，然后就可以使用 mongodump、 mongorestore、 mongoimport、 mongoexport 命名来备份了")]),a._v(" "),n("li",[a._v("在导入其他人的库后，应该清空 --\x3e该库下的用户 --\x3e再创建用户后再链接")])]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("备份单个表\nmongodump -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("  --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" --authenticationDatabase admin -d myTest -c d -o /backup/mongodb/myTest_d_bak_201507021701.bak\n\n备份单个库\nmongodump  -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("  --authenticationDatabase admin -d myTest -o  /backup/mongodb/\n\n备份所有库\nmongodump  -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" --authenticationDatabase admin  --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" -o /root/bak \n\n备份所有库推荐使用添加--oplog参数的命令，这样的备份是基于某一时间点的快照，只能用于备份全部库时才可用，单库和单表不适用：\nmongodump -h "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("   --oplog -o  /root/bak \n\n同时，恢复时也要加上--oplogReplay参数，具体命令如下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("下面是恢复单库的命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("：\nmongorestore  -d swrd --oplogReplay  /home/mongo/swrdbak/swrd/\n\n\n恢复单个库：\nmongorestore  -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("  --authenticationDatabase admin -d myTest   /backup/mongodb/\n\n恢复所有库：\nmongorestore   -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" --port "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("  --authenticationDatabase admin  /root/bak\n\n恢复单表\nmongorestore -u  superuser -p "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("  --authenticationDatabase admin -d myTest -c d /backup/mongodb/myTest_d_bak_201507021701.bak/myTest/d.bson\n\n注意：\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".mongorestore恢复数据默认是追加，如打算先删除后导入，可以加上--drop参数，不过添加--drop参数后，会将数据库数据清空后再导入，如果数据库备份后又新加入了数据，也会将新加的数据删除，它不像mysql有一个存在的判断\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".mongodump在mongo关闭时，也是可以备份的，不过需要指定数据目录，命令为：mongodump  --dbpath  /data/db\n")])])]),n("h3",{attrs:{id:"_7-mongodump与mongoexport的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-mongodump与mongoexport的区别","aria-hidden":"true"}},[a._v("#")]),a._v(" 7-mongodump与mongoexport的区别")]),a._v(" "),n("ol",[n("li",[a._v("mongodump导出的是bson格式，是二进制形式，不过可以使用mongo自带的bsondump命令查看里面的数据，而mongoexport导出的则是文本，可以是csv、json格式。")]),a._v(" "),n("li",[a._v("JSON可读性强但体积较大，BSON则是二进制文件，体积小但对人类几乎没有可读性。")]),a._v(" "),n("li",[a._v("在一些mongodb版本之间，BSON格式可能会随版本不同而有所不同，所以不同版本之间用mongodump/mongorestore可能不会成功，具体要看版本之间的兼容性。         当无法使用BSON进行跨版本的数据迁移的时候，使用JSON格式即mongoexport/mongoimport是 一个可选项。跨版本的mongodump/mongorestore个人并不推荐，实在要做请先检查文档看两个版本是否兼容（大部分时候是的）")]),a._v(" "),n("li",[a._v("JSON虽然具有较好的跨版本通用性，但其只保留了数据部分，不保留索引，账户等其他基础信息。使用时应该注意。")])]),a._v(" "),n("h2",{attrs:{id:"数据库和集合的创建和删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库和集合的创建和删除","aria-hidden":"true"}},[a._v("#")]),a._v(" 数据库和集合的创建和删除")]),a._v(" "),n("h3",{attrs:{id:"gui-下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gui-下载","aria-hidden":"true"}},[a._v("#")]),a._v(" GUI 下载")]),a._v(" "),n("p",[a._v("mongoDB GUI -"),n("a",{attrs:{href:"https://robomongo.org/download",target:"_blank",rel:"noopener noreferrer"}},[a._v("Robo 3T"),n("OutboundLink")],1)]),a._v(" "),n("h3",{attrs:{id:"使用-数据库、-创建数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-数据库、-创建数据库","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用 数据库、 创建数据库")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建或使用student数据库")]),a._v("\nuse student\n")])])]),n("h3",{attrs:{id:"删除数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库","aria-hidden":"true"}},[a._v("#")]),a._v(" 删除数据库")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.dropDatabase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"创建集合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建集合","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建集合")]),a._v(" "),n("p",[a._v("数据库中不能直接插入数据，只能往集合(collections)中插入数据。不需要专门创建集合，只\n需要写点语法插入数据就会创建集合：")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用数据库")]),a._v("\nuse student\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 插入数据")]),a._v("\ndb.user.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xiaoming"')]),a._v(",age:30,desc:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我是小明"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("p",[n("code",[a._v("db.user")]),a._v("系统发现 "),n("code",[a._v("user")]),a._v(" 是一个陌生的集合名字，所以就自动创建了集合。")]),a._v(" "),n("p",[a._v("show collections 显示当前数据库的集合")]),a._v(" "),n("h3",{attrs:{id:"删除集合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除集合","aria-hidden":"true"}},[a._v("#")]),a._v(" 删除集合")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("db.user.drop()\n")])])]),n("h2",{attrs:{id:"crud"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#crud","aria-hidden":"true"}},[a._v("#")]),a._v(" CRUD")]),a._v(" "),n("h3",{attrs:{id:"创建数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建数据","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建数据")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xiaoming"')]),a._v(",age:30,desc:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我是小明"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ndb.user.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xiaoming"')]),a._v(",age:28,desc:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我是小明2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ndb.user.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"linan"')]),a._v(",age:21,desc:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我是李兰"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ndb.user.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"zhangfei"')]),a._v(",age:27,desc:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我是张飞"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"查询数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询数据","aria-hidden":"true"}},[a._v("#")]),a._v(" 查询数据")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('# 查询数据\ndb.user.find()\n\n# 查询去掉后的当前聚集集合中的某列的重复数据 会过滤掉 name 中的相同数据\ndb.user.distinct("name")\n\n# 查询age=30的数据\ndb.user.find({age:30})\n\n# 查询age>21的数据\ndb.user.find({age:{$gt:21}})\n\n# 查询age<22的数据\ndb.user.find({age:{$lt:22}})\n\n# 查询age>=21的数据\ndb.user.find({age:{$gte:21}})\n\n# 查询age<=22的数据\ndb.user.find({age:{$lte:22}})\n\n# 查询age<=28并且age>=22的数据\ndb.user.find({age:{$gte:22,$lte:28}})\n\n# 查询 name  中包含 fei  的数据 模糊查询用于搜索\ndb.user.find({name:/fei/})\n\n# 查询 name 中以 zhang 开头的数据\ndb.user.find({name:/^zhang/})\n\n# 查询指定列 name 、age 数据\n#当然 name 也可以用 true 或 false,当用 ture 的情况下河 name:1 效果一样，如果用 false 就\n#是排除 name，显示 name 以外的列信息。\ndb.user.find({},{name:1,age:1})\n\n# 查询指定列 name 、age  数据, age > 25\ndb.user.find({age:{$lt:25}},{name:true,age:true})\n\n# 按照年龄排序 1  升序 -1\ndb.user.find().sort({age:-1})\ndb.user.find().sort({age:1})\n\n# 查询前 2 条数据\ndb.user.find().limit(2)\n\n# 查询 10 条以后的数据\ndb.user.find().skip(10)\n\n# 查询5-10条的数据\ndb.user.find().skip(5).limit(5)\n\n# or  与  查询\ndb.user.find({$or: [{age: 21}, {age: 28}]})\n\n# 查询第一条数据\ndb.user.findOne()\n\n# 查询某个结果集的记录条数 统计数量\ndb.user.find({age:{$gt:22}}).count()\n')])])]),n("h3",{attrs:{id:"更新数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新数据","aria-hidden":"true"}},[a._v("#")]),a._v(" 更新数据")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.collection.update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("query"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(",\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("update"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(",\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n     upsert: "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("boolean"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(",\n     multi: "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("boolean"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(",\n     writeConcern: "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("document"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),n("p",[n("strong",[a._v("参数说明：")])]),a._v(" "),n("ul",[n("li",[n("strong",[a._v("query")]),a._v(" : update 的查询条件，类似 sql update 查询内 where 后面的。")]),a._v(" "),n("li",[n("strong",[a._v("update")]),a._v(" : update 的对象和一些更新的操作符（如$,$inc...）等，也可以理解为 sql update 查询内 set 后面的")]),a._v(" "),n("li",[n("strong",[a._v("upsert")]),a._v(" : 可选，这个参数的意思是，如果不存在 update 的记录，是否插入 objNew,true 为插入，默认是 false，不插入。")]),a._v(" "),n("li",[n("strong",[a._v("multi")]),a._v(" : 可选，mongodb 默认是 false,只更新找到的第一条记录，如果这个参数为 true,就把按条件查出来多条记录全部更新。")]),a._v(" "),n("li",[n("strong",[a._v("writeConcern")]),a._v(" :可选，抛出异常的级别。")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('# 查找名字叫做xiaoming的，把年龄更改为 16 岁,成绩-数学：60分\ndb.user.update({name:\'xiaoming\'},{$set:{age:16,\'scope.shuxue\':60}})\n\n# 更改所有匹配项目\ndb.user.update({sex:""},{$set:{sex:"男"}},{multi:true})\n\n# age增加10\ndb.user.update({sex:"男"},{$inc:{age:10}},false,true)\n')])])]),n("h3",{attrs:{id:"删除数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除数据","aria-hidden":"true"}},[a._v("#")]),a._v(" 删除数据")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("db.collection.remove(\n   <query>,\n   {\n     justOne: <boolean>,\n     writeConcern: <document>\n   }\n)\n")])])]),n("p",[n("strong",[a._v("参数说明：")])]),a._v(" "),n("ul",[n("li",[n("strong",[a._v("query")]),a._v(" :（可选）删除的文档的条件。")]),a._v(" "),n("li",[n("strong",[a._v("justOne")]),a._v(" : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。")]),a._v(" "),n("li",[n("strong",[a._v("writeConcern")]),a._v(" :（可选）抛出异常的级别。")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("db.users.remove({name: 'xiaoming'});\n")])])]),n("h2",{attrs:{id:"索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#索引","aria-hidden":"true"}},[a._v("#")]),a._v(" 索引")]),a._v(" "),n("p",[a._v("索引是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得更快。MongoDB 的索引几乎与传统的关系型数据库一模一样，这其中也包括一些基本的查询优化技巧。")]),a._v(" "),n("h3",{attrs:{id:"创建索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建索引","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建索引")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.ensureIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"获取索引集合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取索引集合","aria-hidden":"true"}},[a._v("#")]),a._v(" 获取索引集合")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.getIndexes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"删除索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除索引","aria-hidden":"true"}},[a._v("#")]),a._v(" 删除索引")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.dropIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"创建-复合索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-复合索引","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建 复合索引")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("db.user.ensureIndex({name:1,age:-1})\n")])])]),n("p",[a._v("数字 1 表示 name 键的索引按升序存储，-1 表示 age 键的索引按照降序方式存储。")]),a._v(" "),n("p",[a._v("该索引被创建后，基于 username 和 age 的查询将会用到该索引，或者是基于 name 的查询也会用到该索引， 但是只是基于 age 的查询将不会用到该复合索引。因此可以说，如果想用到复合索引，必须在查询条件中包含复合索引中的前 N 个索引列。然而如果查询条件中的键值顺序和复合索引中的创建顺序不一致的话，MongoDB 可以智能的帮助我们调整该顺序，以便使复合索引可以为查询所用。")]),a._v(" "),n("h3",{attrs:{id:"在创建索引时为其指定索引名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在创建索引时为其指定索引名","aria-hidden":"true"}},[a._v("#")]),a._v(" 在创建索引时为其指定索引名")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.ensureIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(","),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name:"),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nameIndex"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),n("p",[a._v("随着集合的增长，需要针对查询中大量的排序做索引。如果没有对索引的键调用 sort， MongoDB 需要将所有数据提取到内存并排序。因此在做无索引排序时，如果数据量过大时 致无法在内存中进行排序，此时 MongoDB 将会报错。")])]),a._v(" "),n("h3",{attrs:{id:"唯一索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#唯一索引","aria-hidden":"true"}},[a._v("#")]),a._v(" 唯一索引")]),a._v(" "),n("p",[a._v("在缺省情况下创建的索引均不是唯一索引。下面的示例将创建唯一索引，如：")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('db.user.ensureIndex({"name":1},{"unique":true})\n')])])]),n("p",[a._v("如果再次插入 name 重复的文档时，MongoDB 将报错，以提示插入重复键")]),a._v(" "),n("h3",{attrs:{id:"索引的一些参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#索引的一些参数","aria-hidden":"true"}},[a._v("#")]),a._v(" 索引的一些参数")]),a._v(" "),n("p",[n("img",{attrs:{src:t(207),alt:"参数"}}),a._v("\n如果在为已有数据的文档创建索引时，可以执行下面的命令，以使 MongoDB 在后台创建索引，这样的创建时就不会阻塞其他操作。但是相比而言，以阻塞方式创建索引，会使整个创建过程效率更高，但是在创建时 MongoDB 将无法接收其他的操作。")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("db.user.ensureIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"username"')]),a._v(":1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(","),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"background"')]),a._v(":true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"使用-explain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-explain","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用 explain")]),a._v(" "),n("p",[a._v("explain 是非常有用的工具，会帮助你获得查询方面诸多有用的信息。只要对游标调用该方法，就可以得到查询细节。explain 会返回一个文档，而不是游标本身。如")]),a._v(" "),n("p",[n("img",{attrs:{src:t(208),alt:"结果"}})]),a._v(" "),n("p",[a._v("explain 会返回查询使用的索引情况，耗时和扫描文档数的统计信息")]),a._v(" "),n("h3",{attrs:{id:"explain-executionstats-查询具体的执行时间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explain-executionstats-查询具体的执行时间","aria-hidden":"true"}},[a._v("#")]),a._v(" explain executionStats  查询具体的执行时间")]),a._v(" "),n("p",[a._v('db.tablename.find().explain( "executionStats" )\n关注输出的如下数值：explain.executionStats.executionTimeMillis')])])},[],!1,null,null,null);s.default=e.exports}}]);