(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{209:function(t,s,a){t.exports=a.p+"assets/img/8.275523a2.jpg"},210:function(t,s,a){t.exports=a.p+"assets/img/9.3347862a.jpg"},211:function(t,s,a){t.exports=a.p+"assets/img/10.dd7694d9.jpg"},255:function(t,s,a){"use strict";a.r(s);var n=a(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"聚合查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#聚合查询","aria-hidden":"true"}},[t._v("#")]),t._v(" 聚合查询")]),t._v(" "),n("h2",{attrs:{id:"聚合管道"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#聚合管道","aria-hidden":"true"}},[t._v("#")]),t._v(" 聚合管道")]),t._v(" "),n("p",[t._v("使用聚合管道可以对集合中的文档进行变换和组合")]),t._v(" "),n("p",[t._v("实际项目：表关联查询、数据的统计")]),t._v(" "),n("p",[t._v("MongoDB 中使用 db.COLLECTION_NAME.aggregate([{"),n("stage",[t._v("},...]) 方法来构建和使用聚合管道。先看下官网给的实例，感受一下聚合管道的用法。")])],1),t._v(" "),n("p",[n("img",{attrs:{src:a(209),alt:"安装"}})]),t._v(" "),n("h2",{attrs:{id:"aggregation-管道操作符与表达式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#aggregation-管道操作符与表达式","aria-hidden":"true"}},[t._v("#")]),t._v(" Aggregation  管道操作符与表达式")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("管道操作符")]),t._v(" "),n("th",[t._v("Description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("$project")]),t._v(" "),n("td",[t._v("增加、删除、重命名字段")])]),t._v(" "),n("tr",[n("td",[t._v("$match")]),t._v(" "),n("td",[t._v("条件匹配。只满足条件的文档才能进入下一阶段")])]),t._v(" "),n("tr",[n("td",[t._v("$limit")]),t._v(" "),n("td",[t._v("限制结果的数量")])]),t._v(" "),n("tr",[n("td",[t._v("$skip")]),t._v(" "),n("td",[t._v("跳过文档的数量")])]),t._v(" "),n("tr",[n("td",[t._v("$sort")]),t._v(" "),n("td",[t._v("条件排序")])]),t._v(" "),n("tr",[n("td",[t._v("$group")]),t._v(" "),n("td",[t._v("条件组合结果 统计")])]),t._v(" "),n("tr",[n("td",[t._v("$lookup")]),t._v(" "),n("td",[t._v("操作符 用以引入其它集合的数")])])])]),t._v(" "),n("p",[n("strong",[t._v("SQL 和 和 NOSQL  对比")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("WHERE")]),t._v(" "),n("th",[t._v("$match")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("GROUP BY")]),t._v(" "),n("td",[t._v("$group")])]),t._v(" "),n("tr",[n("td",[t._v("HAVING")]),t._v(" "),n("td",[t._v("$match")])]),t._v(" "),n("tr",[n("td",[t._v("SELECT")]),t._v(" "),n("td",[t._v("$project")])]),t._v(" "),n("tr",[n("td",[t._v("ORDER BY")]),t._v(" "),n("td",[t._v("$sort")])]),t._v(" "),n("tr",[n("td",[t._v("LIMIT")]),t._v(" "),n("td",[t._v("$limit")])]),t._v(" "),n("tr",[n("td",[t._v("SUM()")]),t._v(" "),n("td",[t._v("$sum")])]),t._v(" "),n("tr",[n("td",[t._v("COUNT()")]),t._v(" "),n("td",[t._v("$sum")])]),t._v(" "),n("tr",[n("td",[t._v("join")]),t._v(" "),n("td",[t._v("$lookup")])])])]),t._v(" "),n("p",[n("strong",[t._v("管道表达式:")])]),t._v(" "),n("p",[t._v("管道操作符作为“键”,所对应的“值”叫做管道表达式。")]),t._v(" "),n("p",[t._v('例如{$match:{status:"A"}}，$match 称为管道操作符，而 status:"A"称为管道表达式，是管道操作符的操作数(Operand)。')]),t._v(" "),n("p",[t._v("每个管道表达式是一个文档结构，它是由字段名、字段值、和一些表达式操作符组成的")]),t._v(" "),n("p",[n("img",{attrs:{src:a(210),alt:"安装"}})]),t._v(" "),n("h2",{attrs:{id:"数据模拟"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据模拟","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据模拟")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uid"')]),t._v(":10,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(":100,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_num"')]),t._v(":2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uid"')]),t._v(":7,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(":90,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_num"')]),t._v(":2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uid"')]),t._v(":9,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"333"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(":20,"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_num"')]),t._v(":6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商品鼠标 1"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":50,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商品键盘 2"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":50,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商品键盘 3"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":0,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"牛奶"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":50,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"酸奶"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":40,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"矿泉水"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":2,num:5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb.order_item.insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"毛巾"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":10,num:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(211),alt:"数据"}})]),t._v(" "),n("h2",{attrs:{id:"project"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#project","aria-hidden":"true"}},[t._v("#")]),t._v(" $project")]),t._v(" "),n("p",[t._v("修改文档的结构，可以用来重命名、增加或删除文档中的字段")]),t._v(" "),n("p",[t._v("要求查找 order 只返回文档中 trade_no 和 all_price 字段")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a88"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a89"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8a"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"333"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"match"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#match","aria-hidden":"true"}},[t._v("#")]),t._v(" $match")]),t._v(" "),n("p",[t._v("用于过滤文档。用法类似于 find() 方法中的参数")]),t._v(" "),n("p",[t._v("查询all_price>=90的数据")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gte")]),t._v(":90"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a88"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a89"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"group"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#group","aria-hidden":"true"}},[t._v("#")]),t._v(" $group")]),t._v(" "),n("p",[t._v("将集合中的文档进行分组，可用于统计结果。")]),t._v(" "),n("p",[t._v("统计每个订单的订单数量，按照订单号分组")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order_item.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$group")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t_id:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$order_id")]),t._v('"')]),t._v(",total:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sum")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$num")]),t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"total"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"total"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"total"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"sort"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sort","aria-hidden":"true"}},[t._v("#")]),t._v(" $sort")]),t._v(" "),n("p",[t._v("将集合中的文档进行排序")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gte")]),t._v(":90"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a89"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a88"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"limit"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#limit","aria-hidden":"true"}},[t._v("#")]),t._v(" $limit")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gte")]),t._v(":90"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$limit")]),t._v(":1\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a89"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"skip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#skip","aria-hidden":"true"}},[t._v("#")]),t._v(" $skip")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("db.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gte")]),t._v(":90"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$skip")]),t._v(":1\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a88"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"lookup-表关联"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lookup-表关联","aria-hidden":"true"}},[t._v("#")]),t._v(" $lookup  表关联")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('db.order.aggregate([\n\t{\n\t\t$lookup:{\n\t\t\tfrom:"order_item",\n\t\t\tlocalField:"order_id",\n\t\t\tforeignField:"order_id",\n\t\t\tas:"items"\n\t\t}\n\t}\n])\n\n\n\n# result\n{\n\t"_id": ObjectId("5f968225df74d5d668c61a88"),\n\t"order_id": "1",\n\t"uid": 10,\n\t"trade_no": "111",\n\t"all_price": 100,\n\t"all_num": 2,\n\t"items": [{\n\t\t"_id": ObjectId("5f968225df74d5d668c61a8b"),\n\t\t"order_id": "1",\n\t\t"title": "商品鼠标 1",\n\t\t"price": 50,\n\t\t"num": 1\n\t}, {\n\t\t"_id": ObjectId("5f968225df74d5d668c61a8c"),\n\t\t"order_id": "1",\n\t\t"title": "商品键盘 2",\n\t\t"price": 50,\n\t\t"num": 1\n\t}, {\n\t\t"_id": ObjectId("5f968225df74d5d668c61a8d"),\n\t\t"order_id": "1",\n\t\t"title": "商品键盘 3",\n\t\t"price": 0,\n\t\t"num": 1\n\t}]\n} {\n\t"_id": ObjectId("5f968225df74d5d668c61a89"),\n\t"order_id": "2",\n\t"uid": 7,\n\t"trade_no": "222",\n\t"all_price": 90,\n\t"all_num": 2,\n\t"items": [{\n\t\t"_id": ObjectId("5f968225df74d5d668c61a8e"),\n\t\t"order_id": "2",\n\t\t"title": "牛奶",\n\t\t"price": 50,\n\t\t"num": 1\n\t}, {\n\t\t"_id": ObjectId("5f968225df74d5d668c61a8f"),\n\t\t"order_id": "2",\n\t\t"title": "酸奶",\n\t\t"price": 40,\n\t\t"num": 1\n\t}]\n} {\n\t"_id": ObjectId("5f968225df74d5d668c61a8a"),\n\t"order_id": "3",\n\t"uid": 9,\n\t"trade_no": "333",\n\t"all_price": 20,\n\t"all_num": 6,\n\t"items": [{\n\t\t"_id": ObjectId("5f968225df74d5d668c61a90"),\n\t\t"order_id": "3",\n\t\t"title": "矿泉水",\n\t\t"price": 2,\n\t\t"num": 5\n\t}, {\n\t\t"_id": ObjectId("5f968225df74d5d668c61a91"),\n\t\t"order_id": "3",\n\t\t"title": "毛巾",\n\t\t"price": 10,\n\t\t"num": 1\n\t}]\n}\n')])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 条件查询，排序，显示固定字段")]),t._v("\ndb.order.aggregate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$lookup")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tfrom:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_item"')]),t._v(",\n\t\t\tlocalField:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),t._v(",\n\t\t\tforeignField:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),t._v(",\n\t\t\tas:"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"items"')]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trade_no:1,all_price:1,items:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sort")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$match")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("all_price:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gte")]),t._v(":90"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a89"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"222"')]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"items"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8e"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"牛奶"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8f"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"酸奶"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a88"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111"')]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all_price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(",\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"items"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8b"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商品鼠标 1"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商 品键盘 2"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ObjectId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5f968225df74d5d668c61a8d"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order_id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"商品键盘 3"')]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])},[],!1,null,null,null);s.default=r.exports}}]);