<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mongoDB | 前端开发笔记</title>
    <meta name="description" content="前端开发笔记">
    <link rel="icon" href="/blog/icon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.45e5a3ae.css" as="style"><link rel="preload" href="/blog/assets/js/app.ee223f02.js" as="script"><link rel="preload" href="/blog/assets/js/2.f364336e.js" as="script"><link rel="preload" href="/blog/assets/js/6.86e346f0.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.60d9a5c4.js"><link rel="prefetch" href="/blog/assets/js/11.9d12addb.js"><link rel="prefetch" href="/blog/assets/js/12.8ef0bd8a.js"><link rel="prefetch" href="/blog/assets/js/13.71ffc42f.js"><link rel="prefetch" href="/blog/assets/js/14.25b3510a.js"><link rel="prefetch" href="/blog/assets/js/15.c4d91af5.js"><link rel="prefetch" href="/blog/assets/js/16.948c6a33.js"><link rel="prefetch" href="/blog/assets/js/17.0e6c3b39.js"><link rel="prefetch" href="/blog/assets/js/18.5f7af77b.js"><link rel="prefetch" href="/blog/assets/js/19.3d23eaff.js"><link rel="prefetch" href="/blog/assets/js/20.472050f8.js"><link rel="prefetch" href="/blog/assets/js/21.daaff1eb.js"><link rel="prefetch" href="/blog/assets/js/22.ae3ff2ee.js"><link rel="prefetch" href="/blog/assets/js/23.06d58a4e.js"><link rel="prefetch" href="/blog/assets/js/24.8df026f6.js"><link rel="prefetch" href="/blog/assets/js/25.8fa3c5ac.js"><link rel="prefetch" href="/blog/assets/js/26.b9e79cc9.js"><link rel="prefetch" href="/blog/assets/js/27.0c29d378.js"><link rel="prefetch" href="/blog/assets/js/28.5c6b388b.js"><link rel="prefetch" href="/blog/assets/js/29.a0f69e48.js"><link rel="prefetch" href="/blog/assets/js/3.641e1028.js"><link rel="prefetch" href="/blog/assets/js/30.dc7fbcb3.js"><link rel="prefetch" href="/blog/assets/js/31.a0f54c32.js"><link rel="prefetch" href="/blog/assets/js/32.06b2a848.js"><link rel="prefetch" href="/blog/assets/js/33.1707ffb1.js"><link rel="prefetch" href="/blog/assets/js/34.4a894dbb.js"><link rel="prefetch" href="/blog/assets/js/35.380e3cca.js"><link rel="prefetch" href="/blog/assets/js/36.cbda8a08.js"><link rel="prefetch" href="/blog/assets/js/37.a4ee9d32.js"><link rel="prefetch" href="/blog/assets/js/38.9d939308.js"><link rel="prefetch" href="/blog/assets/js/39.0db069f8.js"><link rel="prefetch" href="/blog/assets/js/4.dd025489.js"><link rel="prefetch" href="/blog/assets/js/40.7207834f.js"><link rel="prefetch" href="/blog/assets/js/41.a0452c50.js"><link rel="prefetch" href="/blog/assets/js/42.2122454f.js"><link rel="prefetch" href="/blog/assets/js/43.8bb0a71b.js"><link rel="prefetch" href="/blog/assets/js/44.3e769886.js"><link rel="prefetch" href="/blog/assets/js/5.2cc523f9.js"><link rel="prefetch" href="/blog/assets/js/7.d17b9335.js"><link rel="prefetch" href="/blog/assets/js/8.b2177cb3.js"><link rel="prefetch" href="/blog/assets/js/9.a8aca7d1.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.45e5a3ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">前端开发笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/framework/jquery/" class="nav-link">jquery源码分析</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">vue最佳实践</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/mobile-base-template.html" class="nav-link">vue移动端模版</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/blog/mina/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/dd-utils.html" class="nav-link">自定义工具函数库</a></li><li class="dropdown-item"><!----> <a href="/blog/vscode-plugins/" class="nav-link">vscode常用插件</a></li><li class="dropdown-item"><!----> <a href="/blog/vuepress/" class="nav-link">vuepress</a></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/blog/mock/" class="nav-link">mock</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/" class="nav-link">工具函數</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/date.html" class="nav-link">日期函數</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mongoDB/" class="nav-link router-link-exact-active router-link-active">mongoDB学习</a></li><li class="dropdown-item"><!----> <a href="/blog/mongoDB/learning/aggregate.html" class="nav-link">mongoDB aggregate</a></li><li class="dropdown-item"><!----> <a href="/blog/mongoDB/learning/mongoose.html" class="nav-link">mongoose</a></li><li class="dropdown-item"><!----> <a href="/blog/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/svg-canvas/svg.html" class="nav-link">svg</a></li><li class="dropdown-item"><!----> <a href="/blog/svg-canvas/canvas.html" class="nav-link">canvas</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">electron</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/electron/" class="nav-link">electron 基础</a></li><li class="dropdown-item"><!----> <a href="/blog/electron/meos.html" class="nav-link">electron 进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">egg</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/egg/" class="nav-link">egg最佳实践</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask.html" class="nav-link">egg ask项目后端</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask-client.html" class="nav-link">egg ask项目前端</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask-client.html" class="nav-link">egg ask项目管理平台</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">uniapp</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/uniapp/xiaomi.html" class="nav-link">项目实战-xiaomi</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/scaffold/" class="nav-link">手撸一个前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/gulp_multi_pages/" class="nav-link">gulp多页面应用脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/regexp/" class="nav-link">正则学习</a></li><li class="dropdown-item"><!----> <a href="/blog/webapp/" class="nav-link">webapp</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MrMoveon/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/framework/jquery/" class="nav-link">jquery源码分析</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">vue最佳实践</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/mobile-base-template.html" class="nav-link">vue移动端模版</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/blog/mina/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/dd-utils.html" class="nav-link">自定义工具函数库</a></li><li class="dropdown-item"><!----> <a href="/blog/vscode-plugins/" class="nav-link">vscode常用插件</a></li><li class="dropdown-item"><!----> <a href="/blog/vuepress/" class="nav-link">vuepress</a></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/blog/mock/" class="nav-link">mock</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/" class="nav-link">工具函數</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/date.html" class="nav-link">日期函數</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mongoDB/" class="nav-link router-link-exact-active router-link-active">mongoDB学习</a></li><li class="dropdown-item"><!----> <a href="/blog/mongoDB/learning/aggregate.html" class="nav-link">mongoDB aggregate</a></li><li class="dropdown-item"><!----> <a href="/blog/mongoDB/learning/mongoose.html" class="nav-link">mongoose</a></li><li class="dropdown-item"><!----> <a href="/blog/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/svg-canvas/svg.html" class="nav-link">svg</a></li><li class="dropdown-item"><!----> <a href="/blog/svg-canvas/canvas.html" class="nav-link">canvas</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">electron</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/electron/" class="nav-link">electron 基础</a></li><li class="dropdown-item"><!----> <a href="/blog/electron/meos.html" class="nav-link">electron 进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">egg</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/egg/" class="nav-link">egg最佳实践</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask.html" class="nav-link">egg ask项目后端</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask-client.html" class="nav-link">egg ask项目前端</a></li><li class="dropdown-item"><!----> <a href="/blog/egg/ask-client.html" class="nav-link">egg ask项目管理平台</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">uniapp</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/uniapp/xiaomi.html" class="nav-link">项目实战-xiaomi</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/scaffold/" class="nav-link">手撸一个前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/gulp_multi_pages/" class="nav-link">gulp多页面应用脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/regexp/" class="nav-link">正则学习</a></li><li class="dropdown-item"><!----> <a href="/blog/webapp/" class="nav-link">webapp</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MrMoveon/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>mongoDB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/mongoDB/#mongodb-安装和常用配置" class="sidebar-link">mongoDB 安装和常用配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_1-mongodb-4-x-安装和配置" class="sidebar-link">1-mongoDB 4.X 安装和配置</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_2-mongodb-账户权限配置" class="sidebar-link">2-MongoDB 账户权限配置</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_3-mongodb-账户权限配置中常用的命令" class="sidebar-link">3-Mongodb 账户权限配置中常用的命令</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_4-mongodb-数据库角色" class="sidebar-link">4-Mongodb 数据库角色</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_5-连接数据库的时候需要配置账户密码" class="sidebar-link">5-连接数据库的时候需要配置账户密码</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_6-导出与恢复" class="sidebar-link">6- 导出与恢复</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#_7-mongodump与mongoexport的区别" class="sidebar-link">7-mongodump与mongoexport的区别</a></li></ul></li><li><a href="/blog/mongoDB/#数据库和集合的创建和删除" class="sidebar-link">数据库和集合的创建和删除</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mongoDB/#gui-下载" class="sidebar-link">GUI 下载</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#使用-数据库、-创建数据库" class="sidebar-link">使用 数据库、 创建数据库</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#删除数据库" class="sidebar-link">删除数据库</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#创建集合" class="sidebar-link">创建集合</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#删除集合" class="sidebar-link">删除集合</a></li></ul></li><li><a href="/blog/mongoDB/#crud" class="sidebar-link">CRUD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mongoDB/#创建数据" class="sidebar-link">创建数据</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#查询数据" class="sidebar-link">查询数据</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#更新数据" class="sidebar-link">更新数据</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#删除数据" class="sidebar-link">删除数据</a></li></ul></li><li><a href="/blog/mongoDB/#索引" class="sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/mongoDB/#创建索引" class="sidebar-link">创建索引</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#获取索引集合" class="sidebar-link">获取索引集合</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#删除索引" class="sidebar-link">删除索引</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#创建-复合索引" class="sidebar-link">创建 复合索引</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#在创建索引时为其指定索引名" class="sidebar-link">在创建索引时为其指定索引名</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#唯一索引" class="sidebar-link">唯一索引</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#索引的一些参数" class="sidebar-link">索引的一些参数</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#使用-explain" class="sidebar-link">使用 explain</a></li><li class="sidebar-sub-header"><a href="/blog/mongoDB/#explain-executionstats-查询具体的执行时间" class="sidebar-link">explain executionStats  查询具体的执行时间</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a> mongoDB</h1> <h2 id="mongodb-安装和常用配置"><a href="#mongodb-安装和常用配置" aria-hidden="true" class="header-anchor">#</a> mongoDB 安装和常用配置</h2> <h3 id="_1-mongodb-4-x-安装和配置"><a href="#_1-mongodb-4-x-安装和配置" aria-hidden="true" class="header-anchor">#</a> 1-mongoDB 4.X 安装和配置</h3> <p>1.社区版<a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="/blog/assets/img/1.b8f857ab.jpg" alt="安装"></p> <p>2.配置环境变量</p> <ul><li>安装目录下的 bin 目录 ;</li> <li>如:C:\z_MongoDB\bin；</li> <li>配置到系统环境变量中（控制面板\系统和安全\系统\高级系统设置\环境变量；</li> <li>会自动添加到服务中了；</li> <li>重启运行命令 services.msc（window10）打开服务界面，此时已经自动添加到系统服务里面了，每次开机自动重启</li></ul> <p><img src="/blog/assets/img/2.077a29f1.jpg" alt="path环境变量"> <img src="/blog/assets/img/3.79cb14e0.jpg" alt="服务"> <img src="/blog/assets/img/4.2815a67a.jpg" alt="运行结果"></p> <h3 id="_2-mongodb-账户权限配置"><a href="#_2-mongodb-账户权限配置" aria-hidden="true" class="header-anchor">#</a> 2-MongoDB 账户权限配置</h3> <h4 id="_1-创建超级管理员"><a href="#_1-创建超级管理员" aria-hidden="true" class="header-anchor">#</a> 1.创建超级管理员</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>use admin
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>
    user:<span class="token string">'admin'</span>，
    pwd:<span class="token string">'123456'</span>,
    roles:<span class="token punctuation">[</span><span class="token punctuation">{</span>role:<span class="token string">'root'</span>,db:<span class="token string">'admin'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-修改-mongodb-数据库配置文件"><a href="#_2-修改-mongodb-数据库配置文件" aria-hidden="true" class="header-anchor">#</a> 2.修改 Mongodb 数据库配置文件</h4> <p>找到这个<code>mongod.cfg</code>配置文件 放开 security 表示开启权限验证</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 路径 C:\Program Files\MongoDB\Server\4.4\bin\mongod.cfg</span>
security:
  authorization: enabled
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">注意</p> <p>这个文件有严格的格式，authorization 冒号后面有一个空格，去掉或多加一个空格都会报错</p></div> <h4 id="_3-重启-mongodb"><a href="#_3-重启-mongodb" aria-hidden="true" class="header-anchor">#</a> 3.重启 mongodb</h4> <p><img src="/blog/assets/img/5.1834c504.jpg" alt="重启"></p> <h4 id="_4-超级管理员帐号链接数据库"><a href="#_4-超级管理员帐号链接数据库" aria-hidden="true" class="header-anchor">#</a> 4.超级管理员帐号链接数据库</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>mongo admin -u 帐号 -p 密码
<span class="token comment"># or</span>
mongo <span class="token number">192.168</span>.1.200:27017/test -u user -p password
</code></pre></div><h4 id="_5-给-eggcms-数据库创建一个用户，只能访问-eggcms-不能访问其他数据库"><a href="#_5-给-eggcms-数据库创建一个用户，只能访问-eggcms-不能访问其他数据库" aria-hidden="true" class="header-anchor">#</a> 5.给 eggcms 数据库创建一个用户，只能访问 eggcms 不能访问其他数据库</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>use eggcms
db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        user: <span class="token string">&quot;eggadmin&quot;</span>,
        pwd: <span class="token string">&quot;123456&quot;</span>,
        roles: <span class="token punctuation">[</span> <span class="token punctuation">{</span> role: <span class="token string">&quot;dbOwner&quot;</span>, db: <span class="token string">&quot;eggcms&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-mongodb-账户权限配置中常用的命令"><a href="#_3-mongodb-账户权限配置中常用的命令" aria-hidden="true" class="header-anchor">#</a> 3-Mongodb 账户权限配置中常用的命令</h3> <p><strong>db.createUser 创建用户</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>use eggcms
db.createUser<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        user: <span class="token string">&quot;eggadmin&quot;</span>,
        pwd: <span class="token string">&quot;123456&quot;</span>,
        roles: <span class="token punctuation">[</span> <span class="token punctuation">{</span> role: <span class="token string">&quot;dbOwner&quot;</span>, db: <span class="token string">&quot;eggcms&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment"># result</span>
Successfully added user: <span class="token punctuation">{</span>
    <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;eggadmin&quot;</span>,
    <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;role&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;dbOwner&quot;</span>,
        <span class="token string">&quot;db&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;eggcms&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p><strong>show users 查看当前库下的用户</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">{</span>
        <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;admin.admin&quot;</span>,
        <span class="token string">&quot;userId&quot;</span> <span class="token builtin class-name">:</span> UUID<span class="token punctuation">(</span><span class="token string">&quot;6500ad3e-755c-4d3c-a23b-c0773c112dd8&quot;</span><span class="token punctuation">)</span>,
        <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;admin&quot;</span>,
        <span class="token string">&quot;db&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;admin&quot;</span>,
        <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                        <span class="token string">&quot;role&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
                        <span class="token string">&quot;db&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;admin&quot;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;mechanisms&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;SCRAM-SHA-1&quot;</span>,
                <span class="token string">&quot;SCRAM-SHA-256&quot;</span>
        <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>db.dropUser(&quot;eggadmin&quot;) 删除用户</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 进入数据库eggcms</span>
use eggcms
<span class="token comment"># 删除用户eggadmin</span>
db.dropUser<span class="token punctuation">(</span><span class="token string">&quot;eggadmin&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p><strong>db.updateUser(&quot;eggadmin&quot;,{pwd:&quot;password&quot;}) 修改用户</strong></p> <p><strong>db.auth(&quot;admin&quot;,&quot;password&quot;); 密码认证</strong></p> <h3 id="_4-mongodb-数据库角色"><a href="#_4-mongodb-数据库角色" aria-hidden="true" class="header-anchor">#</a> 4-Mongodb 数据库角色</h3> <ol><li><p>数据库用户角色：read、readWrite;</p></li> <li><p>数据库管理角色：dbAdmin、dbOwner、userAdmin；</p></li> <li><p>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；</p></li> <li><p>备份恢复角色：backup、restore；</p></li> <li><p>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</p></li> <li><p>超级用户角色：root</p></li> <li><p>参考：https://www.cnblogs.com/zzw1787044/p/5773178.html</p></li></ol> <h3 id="_5-连接数据库的时候需要配置账户密码"><a href="#_5-连接数据库的时候需要配置账户密码" aria-hidden="true" class="header-anchor">#</a> 5-连接数据库的时候需要配置账户密码</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'mongodb://admin:123456@localhost:27017/'</span>
</code></pre></div><h3 id="_6-导出与恢复"><a href="#_6-导出与恢复" aria-hidden="true" class="header-anchor">#</a> 6- 导出与恢复</h3> <ol><li>MongoDB 4.4版本 之后 MongoDB数据库工具现在与MongoDB服务 分开发布 需要单独安装 <a href="https://docs.mongodb.com/database-tools/" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>windwos 下载后解压，配置到环境变量 path 中，然后就可以使用 mongodump、 mongorestore、 mongoimport、 mongoexport 命名来备份了</li> <li>在导入其他人的库后，应该清空 --&gt;该库下的用户 --&gt;再创建用户后再链接</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>备份单个表
mongodump -u  superuser -p <span class="token number">123456</span>  --port <span class="token number">27017</span> --authenticationDatabase admin -d myTest -c d -o /backup/mongodb/myTest_d_bak_201507021701.bak

备份单个库
mongodump  -u  superuser -p <span class="token number">123456</span> --port <span class="token number">27017</span>  --authenticationDatabase admin -d myTest -o  /backup/mongodb/

备份所有库
mongodump  -u  superuser -p <span class="token number">123456</span> --authenticationDatabase admin  --port <span class="token number">27017</span> -o /root/bak 

备份所有库推荐使用添加--oplog参数的命令，这样的备份是基于某一时间点的快照，只能用于备份全部库时才可用，单库和单表不适用：
mongodump -h <span class="token number">127.0</span>.0.1 --port <span class="token number">27017</span>   --oplog -o  /root/bak 

同时，恢复时也要加上--oplogReplay参数，具体命令如下<span class="token punctuation">(</span>下面是恢复单库的命令<span class="token punctuation">)</span>：
mongorestore  -d swrd --oplogReplay  /home/mongo/swrdbak/swrd/


恢复单个库：
mongorestore  -u  superuser -p <span class="token number">123456</span> --port <span class="token number">27017</span>  --authenticationDatabase admin -d myTest   /backup/mongodb/

恢复所有库：
mongorestore   -u  superuser -p <span class="token number">123456</span> --port <span class="token number">27017</span>  --authenticationDatabase admin  /root/bak

恢复单表
mongorestore -u  superuser -p <span class="token number">123456</span>  --authenticationDatabase admin -d myTest -c d /backup/mongodb/myTest_d_bak_201507021701.bak/myTest/d.bson

注意：
      <span class="token number">1</span>.mongorestore恢复数据默认是追加，如打算先删除后导入，可以加上--drop参数，不过添加--drop参数后，会将数据库数据清空后再导入，如果数据库备份后又新加入了数据，也会将新加的数据删除，它不像mysql有一个存在的判断
      <span class="token number">2</span>.mongodump在mongo关闭时，也是可以备份的，不过需要指定数据目录，命令为：mongodump  --dbpath  /data/db
</code></pre></div><h3 id="_7-mongodump与mongoexport的区别"><a href="#_7-mongodump与mongoexport的区别" aria-hidden="true" class="header-anchor">#</a> 7-mongodump与mongoexport的区别</h3> <ol><li>mongodump导出的是bson格式，是二进制形式，不过可以使用mongo自带的bsondump命令查看里面的数据，而mongoexport导出的则是文本，可以是csv、json格式。</li> <li>JSON可读性强但体积较大，BSON则是二进制文件，体积小但对人类几乎没有可读性。</li> <li>在一些mongodb版本之间，BSON格式可能会随版本不同而有所不同，所以不同版本之间用mongodump/mongorestore可能不会成功，具体要看版本之间的兼容性。         当无法使用BSON进行跨版本的数据迁移的时候，使用JSON格式即mongoexport/mongoimport是 一个可选项。跨版本的mongodump/mongorestore个人并不推荐，实在要做请先检查文档看两个版本是否兼容（大部分时候是的）</li> <li>JSON虽然具有较好的跨版本通用性，但其只保留了数据部分，不保留索引，账户等其他基础信息。使用时应该注意。</li></ol> <h2 id="数据库和集合的创建和删除"><a href="#数据库和集合的创建和删除" aria-hidden="true" class="header-anchor">#</a> 数据库和集合的创建和删除</h2> <h3 id="gui-下载"><a href="#gui-下载" aria-hidden="true" class="header-anchor">#</a> GUI 下载</h3> <p>mongoDB GUI -<a href="https://robomongo.org/download" target="_blank" rel="noopener noreferrer">Robo 3T<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="使用-数据库、-创建数据库"><a href="#使用-数据库、-创建数据库" aria-hidden="true" class="header-anchor">#</a> 使用 数据库、 创建数据库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建或使用student数据库</span>
use student
</code></pre></div><h3 id="删除数据库"><a href="#删除数据库" aria-hidden="true" class="header-anchor">#</a> 删除数据库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="创建集合"><a href="#创建集合" aria-hidden="true" class="header-anchor">#</a> 创建集合</h3> <p>数据库中不能直接插入数据，只能往集合(collections)中插入数据。不需要专门创建集合，只
需要写点语法插入数据就会创建集合：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 使用数据库</span>
use student
<span class="token comment"># 插入数据</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name:<span class="token string">&quot;xiaoming&quot;</span>,age:30,desc:<span class="token string">&quot;我是小明&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>db.user</code>系统发现 <code>user</code> 是一个陌生的集合名字，所以就自动创建了集合。</p> <p>show collections 显示当前数据库的集合</p> <h3 id="删除集合"><a href="#删除集合" aria-hidden="true" class="header-anchor">#</a> 删除集合</h3> <div class="language- extra-class"><pre class="language-text"><code>db.user.drop()
</code></pre></div><h2 id="crud"><a href="#crud" aria-hidden="true" class="header-anchor">#</a> CRUD</h2> <h3 id="创建数据"><a href="#创建数据" aria-hidden="true" class="header-anchor">#</a> 创建数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name:<span class="token string">&quot;xiaoming&quot;</span>,age:30,desc:<span class="token string">&quot;我是小明&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name:<span class="token string">&quot;xiaoming&quot;</span>,age:28,desc:<span class="token string">&quot;我是小明2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name:<span class="token string">&quot;linan&quot;</span>,age:21,desc:<span class="token string">&quot;我是李兰&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name:<span class="token string">&quot;zhangfei&quot;</span>,age:27,desc:<span class="token string">&quot;我是张飞&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询数据"><a href="#查询数据" aria-hidden="true" class="header-anchor">#</a> 查询数据</h3> <div class="language- extra-class"><pre class="language-text"><code># 查询数据
db.user.find()

# 查询去掉后的当前聚集集合中的某列的重复数据 会过滤掉 name 中的相同数据
db.user.distinct(&quot;name&quot;)

# 查询age=30的数据
db.user.find({age:30})

# 查询age&gt;21的数据
db.user.find({age:{$gt:21}})

# 查询age&lt;22的数据
db.user.find({age:{$lt:22}})

# 查询age&gt;=21的数据
db.user.find({age:{$gte:21}})

# 查询age&lt;=22的数据
db.user.find({age:{$lte:22}})

# 查询age&lt;=28并且age&gt;=22的数据
db.user.find({age:{$gte:22,$lte:28}})

# 查询 name  中包含 fei  的数据 模糊查询用于搜索
db.user.find({name:/fei/})

# 查询 name 中以 zhang 开头的数据
db.user.find({name:/^zhang/})

# 查询指定列 name 、age 数据
#当然 name 也可以用 true 或 false,当用 ture 的情况下河 name:1 效果一样，如果用 false 就
#是排除 name，显示 name 以外的列信息。
db.user.find({},{name:1,age:1})

# 查询指定列 name 、age  数据, age &gt; 25
db.user.find({age:{$lt:25}},{name:true,age:true})

# 按照年龄排序 1  升序 -1
db.user.find().sort({age:-1})
db.user.find().sort({age:1})

# 查询前 2 条数据
db.user.find().limit(2)

# 查询 10 条以后的数据
db.user.find().skip(10)

# 查询5-10条的数据
db.user.find().skip(5).limit(5)

# or  与  查询
db.user.find({$or: [{age: 21}, {age: 28}]})

# 查询第一条数据
db.user.findOne()

# 查询某个结果集的记录条数 统计数量
db.user.find({age:{$gt:22}}).count()
</code></pre></div><h3 id="更新数据"><a href="#更新数据" aria-hidden="true" class="header-anchor">#</a> 更新数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.collection.update<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>,
   <span class="token operator">&lt;</span>update<span class="token operator">&gt;</span>,
   <span class="token punctuation">{</span>
     upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     multi: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p><strong>参数说明：</strong></p> <ul><li><strong>query</strong> : update 的查询条件，类似 sql update 查询内 where 后面的。</li> <li><strong>update</strong> : update 的对象和一些更新的操作符（如$,$inc...）等，也可以理解为 sql update 查询内 set 后面的</li> <li><strong>upsert</strong> : 可选，这个参数的意思是，如果不存在 update 的记录，是否插入 objNew,true 为插入，默认是 false，不插入。</li> <li><strong>multi</strong> : 可选，mongodb 默认是 false,只更新找到的第一条记录，如果这个参数为 true,就把按条件查出来多条记录全部更新。</li> <li><strong>writeConcern</strong> :可选，抛出异常的级别。</li></ul> <div class="language- extra-class"><pre class="language-text"><code># 查找名字叫做xiaoming的，把年龄更改为 16 岁,成绩-数学：60分
db.user.update({name:'xiaoming'},{$set:{age:16,'scope.shuxue':60}})

# 更改所有匹配项目
db.user.update({sex:&quot;&quot;},{$set:{sex:&quot;男&quot;}},{multi:true})

# age增加10
db.user.update({sex:&quot;男&quot;},{$inc:{age:10}},false,true)
</code></pre></div><h3 id="删除数据"><a href="#删除数据" aria-hidden="true" class="header-anchor">#</a> 删除数据</h3> <div class="language- extra-class"><pre class="language-text"><code>db.collection.remove(
   &lt;query&gt;,
   {
     justOne: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   }
)
</code></pre></div><p><strong>参数说明：</strong></p> <ul><li><strong>query</strong> :（可选）删除的文档的条件。</li> <li><strong>justOne</strong> : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。</li> <li><strong>writeConcern</strong> :（可选）抛出异常的级别。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>db.users.remove({name: 'xiaoming'});
</code></pre></div><h2 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h2> <p>索引是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得更快。MongoDB 的索引几乎与传统的关系型数据库一模一样，这其中也包括一些基本的查询优化技巧。</p> <h3 id="创建索引"><a href="#创建索引" aria-hidden="true" class="header-anchor">#</a> 创建索引</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.ensureIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="获取索引集合"><a href="#获取索引集合" aria-hidden="true" class="header-anchor">#</a> 获取索引集合</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="删除索引"><a href="#删除索引" aria-hidden="true" class="header-anchor">#</a> 删除索引</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.dropIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="创建-复合索引"><a href="#创建-复合索引" aria-hidden="true" class="header-anchor">#</a> 创建 复合索引</h3> <div class="language- extra-class"><pre class="language-text"><code>db.user.ensureIndex({name:1,age:-1})
</code></pre></div><p>数字 1 表示 name 键的索引按升序存储，-1 表示 age 键的索引按照降序方式存储。</p> <p>该索引被创建后，基于 username 和 age 的查询将会用到该索引，或者是基于 name 的查询也会用到该索引， 但是只是基于 age 的查询将不会用到该复合索引。因此可以说，如果想用到复合索引，必须在查询条件中包含复合索引中的前 N 个索引列。然而如果查询条件中的键值顺序和复合索引中的创建顺序不一致的话，MongoDB 可以智能的帮助我们调整该顺序，以便使复合索引可以为查询所用。</p> <h3 id="在创建索引时为其指定索引名"><a href="#在创建索引时为其指定索引名" aria-hidden="true" class="header-anchor">#</a> 在创建索引时为其指定索引名</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.ensureIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span>name:<span class="token string">&quot;nameIndex&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">注意</p> <p>随着集合的增长，需要针对查询中大量的排序做索引。如果没有对索引的键调用 sort， MongoDB 需要将所有数据提取到内存并排序。因此在做无索引排序时，如果数据量过大时 致无法在内存中进行排序，此时 MongoDB 将会报错。</p></div> <h3 id="唯一索引"><a href="#唯一索引" aria-hidden="true" class="header-anchor">#</a> 唯一索引</h3> <p>在缺省情况下创建的索引均不是唯一索引。下面的示例将创建唯一索引，如：</p> <div class="language- extra-class"><pre class="language-text"><code>db.user.ensureIndex({&quot;name&quot;:1},{&quot;unique&quot;:true})
</code></pre></div><p>如果再次插入 name 重复的文档时，MongoDB 将报错，以提示插入重复键</p> <h3 id="索引的一些参数"><a href="#索引的一些参数" aria-hidden="true" class="header-anchor">#</a> 索引的一些参数</h3> <p><img src="/blog/assets/img/6.a3a67351.jpg" alt="参数">
如果在为已有数据的文档创建索引时，可以执行下面的命令，以使 MongoDB 在后台创建索引，这样的创建时就不会阻塞其他操作。但是相比而言，以阻塞方式创建索引，会使整个创建过程效率更高，但是在创建时 MongoDB 将无法接收其他的操作。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.ensureIndex<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span>:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;background&quot;</span>:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用-explain"><a href="#使用-explain" aria-hidden="true" class="header-anchor">#</a> 使用 explain</h3> <p>explain 是非常有用的工具，会帮助你获得查询方面诸多有用的信息。只要对游标调用该方法，就可以得到查询细节。explain 会返回一个文档，而不是游标本身。如</p> <p><img src="/blog/assets/img/7.a8304e73.jpg" alt="结果"></p> <p>explain 会返回查询使用的索引情况，耗时和扫描文档数的统计信息</p> <h3 id="explain-executionstats-查询具体的执行时间"><a href="#explain-executionstats-查询具体的执行时间" aria-hidden="true" class="header-anchor">#</a> explain executionStats  查询具体的执行时间</h3> <p>db.tablename.find().explain( &quot;executionStats&quot; )
关注输出的如下数值：explain.executionStats.executionTimeMillis</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/27/2020, 3:31:10 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.ee223f02.js" defer></script><script src="/blog/assets/js/2.f364336e.js" defer></script><script src="/blog/assets/js/6.86e346f0.js" defer></script>
  </body>
</html>
